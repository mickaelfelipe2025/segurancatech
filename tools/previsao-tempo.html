<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Previs√£o do Tempo - Seguran√ßa Tech</title>
  <style>
    :root{--bg:#f4f6f8;--card:#fff;--nav:#122c66;--header:#0a1f44;--text:#0b1220;--muted:#475569;--shadow:0 10px 22px rgba(2,6,23,.10);--radius:14px}
    *{box-sizing:border-box}
    body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;background:var(--bg);color:var(--text)}
    header{background:var(--header);color:#fff;padding:22px 16px;text-align:center}
    nav{background:var(--nav);padding:10px 12px;display:flex;justify-content:center;gap:10px;flex-wrap:wrap;align-items:center;position:sticky;top:0;z-index:999}
    nav a{color:#fff;text-decoration:none;font-weight:700;padding:10px 12px;border-radius:10px}
    nav a:hover{background:rgba(255,255,255,.10)}
    .container{max-width:980px;margin:0 auto;padding:22px 14px}
    .card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);padding:18px}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    input{padding:12px;border:1px solid #d7e1ef;border-radius:12px;font-size:16px;min-width:160px}
    button{padding:12px 14px;border:0;border-radius:12px;background:#122c66;color:#fff;font-weight:800;cursor:pointer}
    button:hover{filter:brightness(1.05)}
    .muted{color:var(--muted);line-height:1.6}
    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:10px;border-bottom:1px solid #eef2f7;text-align:left}
    th{font-weight:900}

    /* =========================
       UPGRADE (SEM MUDAR O TEMA)
    ========================= */
    .stack{display:grid;gap:14px;margin-top:14px}
    .grid2{display:grid;grid-template-columns:1.2fr .8fr;gap:14px}
    @media (max-width:900px){.grid2{grid-template-columns:1fr}}
    .chip{
      display:inline-flex;align-items:center;gap:8px;
      padding:8px 10px;border-radius:999px;
      background:#eef2f7;border:1px solid #d7e1ef;
      font-weight:800;font-size:13px;color:#0b1220
    }
    .pill{
      display:inline-flex;align-items:center;gap:8px;
      padding:10px 12px;border-radius:12px;
      background:#f8fafc;border:1px solid #e5eaf2;
      font-weight:800;color:#0b1220
    }
    .titlebar{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .h2{margin:0;font-size:18px;font-weight:900}
    .small{font-size:13px;color:var(--muted);font-weight:700}
    .divider{height:1px;background:#eef2f7;margin:12px 0}
    .kpi{display:flex;gap:12px;flex-wrap:wrap;align-items:center}
    .tempBig{font-size:54px;line-height:1;font-weight:1000;letter-spacing:-1px}
    .wxDesc{font-size:16px;font-weight:900}
    .miniGrid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:10px;margin-top:10px}
    @media (max-width:560px){.miniGrid{grid-template-columns:1fr}}
    .miniCard{
      background:#f8fafc;border:1px solid #e5eaf2;border-radius:14px;padding:12px
    }
    .miniCard .label{color:var(--muted);font-weight:800;font-size:13px}
    .miniCard .val{font-weight:1000;font-size:18px;margin-top:2px}
    .hours{
      display:flex;gap:10px;overflow:auto;padding-bottom:6px;scroll-snap-type:x mandatory
    }
    .hourCard{
      min-width:120px;scroll-snap-align:start;
      background:#f8fafc;border:1px solid #e5eaf2;border-radius:14px;padding:12px
    }
    .hourTime{font-weight:1000}
    .hourIcon{font-size:20px;margin-top:6px}
    .hourTemp{font-size:20px;font-weight:1000;margin-top:4px}
    .hourMeta{color:var(--muted);font-weight:800;font-size:12px;margin-top:4px;line-height:1.3}
    .days{display:grid;gap:10px;margin-top:10px}
    .dayRow{
      display:grid;grid-template-columns:1fr auto;gap:10px;
      background:#f8fafc;border:1px solid #e5eaf2;border-radius:14px;padding:12px
    }
    .dayLeft{display:grid;gap:4px}
    .dayTop{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .dayName{font-weight:1000}
    .dayIcon{font-size:18px}
    .dayBarWrap{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
    .tMin,.tMax{font-weight:1000}
    .bar{
      flex:1;min-width:160px;height:10px;border-radius:999px;
      background:#e9eef6;position:relative;overflow:hidden;border:1px solid #d7e1ef
    }
    .bar > span{
      position:absolute;top:0;bottom:0;border-radius:999px;background:#122c66;
      opacity:.95
    }
    .dayRight{display:grid;justify-items:end;gap:6px}
    .tag{
      font-size:12px;font-weight:1000;color:#0b1220;
      background:#eef2f7;border:1px solid #d7e1ef;border-radius:999px;padding:6px 10px
    }
    .hint{
      background:#fff7ed;border:1px solid #fed7aa;color:#7c2d12;
      border-radius:14px;padding:12px;font-weight:800;line-height:1.4
    }

    /* dropdown simples da busca */
    .dd{position:relative;flex:1;min-width:240px}
    .ddList{
      position:absolute;left:0;right:0;top:calc(100% + 6px);
      background:#fff;border:1px solid #d7e1ef;border-radius:14px;
      box-shadow:var(--shadow);overflow:hidden;z-index:50;display:none
    }
    .ddList button{
      width:100%;text-align:left;background:#fff;color:#0b1220;border:0;
      padding:12px 12px;font-weight:900;border-radius:0;cursor:pointer
    }
    .ddList button:hover{background:#f1f5f9}
    .ddList .sub{display:block;font-size:12px;color:var(--muted);font-weight:800;margin-top:2px}

    /* =========================
       CONTROLES (layout proporcional)
    ========================= */
    .controls{
      display:grid;
      grid-template-columns: auto minmax(240px, 420px) auto;
      gap:10px;
      align-items:center;
    }
    .controls .dd{min-width:240px; max-width:420px}
    .controls #city{width:100%}

    .controls2{
      display:grid;
      grid-template-columns: 1fr 1fr auto;
      gap:10px;
      align-items:center;
      margin-top:10px;
    }
    .controlsNote{margin-top:12px}

    @media (max-width:900px){
      .controls{grid-template-columns:1fr}
      .controls .dd{max-width:none}
      .controls2{grid-template-columns:1fr}
      .controls button{width:100%}
    }

    /* =========================
       RESUMO DO DIA + ALERTAS
    ========================= */
    .alert{
      background:#eef2f7;
      border:1px solid #d7e1ef;
      border-radius:14px;
      padding:12px;
      font-weight:900;
      color:#0b1220;
      display:flex;
      gap:10px;
      align-items:flex-start;
    }
    .alert .aTitle{font-weight:1000}
    .alert .aText{font-weight:800;color:var(--muted);line-height:1.45;margin-top:2px}
    .tri{
      display:grid;
      grid-template-columns:repeat(3,minmax(0,1fr));
      gap:10px;
    }
    @media (max-width:900px){.tri{grid-template-columns:1fr}}
    .slot{
      background:#f8fafc;border:1px solid #e5eaf2;border-radius:14px;padding:12px
    }
    .slotTop{display:flex;justify-content:space-between;gap:10px;align-items:center}
    .slotName{font-weight:1000}
    .slotIcon{font-size:18px}
    .slotTemp{font-size:28px;font-weight:1000;margin-top:6px}
    .slotMeta{color:var(--muted);font-weight:800;font-size:13px;line-height:1.35;margin-top:6px}

    /* =========================
       FOOTER REAL (SEM TRANSPAR√äNCIA)
    ========================= */
    .st-footer{
      margin-top: 48px;
      padding: 30px 18px 20px;
      background:#0b2a4a; /* COR REAL */
      border-top: none;
    }

    .st-footer__wrap{
      max-width:1100px;
      margin:0 auto;
    }

    .st-footer__grid{
      display:grid;
      grid-template-columns:1.2fr .8fr;
      gap:20px;
    }

    @media (max-width:900px){
      .st-footer__grid{grid-template-columns:1fr}
    }

    .st-footer__card{
      background:#1f3a63; /* CARD */
      border:1px solid #2e4a74;
      border-radius:18px;
      padding:18px;
    }

    .st-footer__title{
      color:#e6edf7;
      margin:0 0 10px;
      font-size:18px;
      font-weight:900;
    }

    .st-footer__text{
      color:#e6edf7;
      font-size:16px;
      line-height:1.6;
      margin:0;
    }

    .st-footer__links{
      display:grid;
      gap:12px;
    }

    .st-footer__link{
      display:block;
      background:#2a4269; /* BOT√ÉO */
      border:1px solid #3a5686;
      padding:14px 16px;
      border-radius:14px;
      color:#e6edf7;
      text-decoration:none;
      font-size:18px;
      font-weight:900;
      transition:.15s;
    }

    .st-footer__link:hover{background:#314d7a}

    .st-footer__hr{
      height:1px;
      background:#2e4a74; /* LINHA */
      margin:24px 0 16px;
    }

    .st-footer__bottom{
      text-align:center;
      color:#e6edf7;
      font-size:14px;
      font-weight:700;
    }

    .st-footer__bottom a{
      color:#e6edf7;
      text-decoration:none;
      font-weight:900;
    }

    .st-footer__bottom a:hover{text-decoration:underline}

    .st-footer__dot{margin:0 8px}
  </style>
</head>
<body>
<header>
  <h1>Previs√£o do Tempo</h1>
  <p>Open-Meteo (sem chave) ‚Ä¢ busca por cidade, localiza√ß√£o ou coordenadas</p>
</header>

<nav>
  <a href="../index.html">Home</a>
  <a href="../sobre.html">Sobre</a>
  <a href="../index.html">Ferramentas</a>
</nav>

<div class="container">
  <div class="card">

    <!-- CONTROLES (proporcional) -->
    <div class="controls">
      <button id="geoBtn">Usar minha localiza√ß√£o</button>

      <div class="dd">
        <input id="city" placeholder="Buscar cidade (ex: Paulino Neves)" autocomplete="off"/>
        <div id="cityList" class="ddList" aria-label="Sugest√µes de cidades"></div>
      </div>

      <button id="cityBtn">Buscar</button>
    </div>

    <div class="controls2">
      <input id="lat" placeholder="Latitude (ex: -2.72)"/>
      <input id="lon" placeholder="Longitude (ex: -42.52)"/>
      <button id="coordBtn">Consultar</button>
    </div>

    <p class="muted controlsNote">
      Dica: use ‚ÄúBuscar cidade‚Äù para ficar igual portal. Se o navegador pedir permiss√£o de localiza√ß√£o, permita.
    </p>

    <div id="out" class="stack" style="margin-top:12px"></div>
  </div>
</div>

<script>
  const out = document.getElementById("out");
  const latEl = document.getElementById("lat");
  const lonEl = document.getElementById("lon");
  const cityEl = document.getElementById("city");
  const cityList = document.getElementById("cityList");

  const LS_KEY = "st_weather_last";

  // Ajuste aqui se quiser:
  const ALERT_POP_THRESHOLD = 70;     // % chance de chuva p/ alertar
  const ALERT_GUST_THRESHOLD = 45;    // km/h rajadas p/ alertar
  const ALERT_LOOKAHEAD_HOURS = 12;   // pr√≥ximas X horas analisadas

  function fmt(n, digits=0){
    if(n == null || !Number.isFinite(Number(n))) return "‚Äî";
    return Number(n).toFixed(digits);
  }
  function clamp(v,min,max){ return Math.max(min, Math.min(max, v)); }

  function pad2(x){ return String(x).padStart(2,"0"); }
  function toPtDay(isoDate){
    const d = new Date(isoDate + "T00:00:00");
    const wd = ["Dom","Seg","Ter","Qua","Qui","Sex","S√°b"][d.getDay()];
    return `${wd} ‚Ä¢ ${pad2(d.getDate())}/${pad2(d.getMonth()+1)}`;
  }
  function toPtHour(iso){
    const d = new Date(iso);
    return `${pad2(d.getHours())}:00`;
  }
  function localDayKey(date){
    return `${date.getFullYear()}-${pad2(date.getMonth()+1)}-${pad2(date.getDate())}`;
  }

  // Weathercode (WMO) -> descri√ß√£o + √≠cone
  function wx(code, isDay=true){
    const map = {
      0:["C√©u limpo", "‚òÄÔ∏è"],
      1:["Poucas nuvens", isDay ? "üå§Ô∏è":"üåô"],
      2:["Parcialmente nublado", "‚õÖ"],
      3:["Nublado", "‚òÅÔ∏è"],
      45:["Nevoeiro", "üå´Ô∏è"],
      48:["Nevoeiro (geada)", "üå´Ô∏è"],
      51:["Garoa fraca", "üå¶Ô∏è"],
      53:["Garoa moderada", "üå¶Ô∏è"],
      55:["Garoa forte", "üåßÔ∏è"],
      56:["Garoa gelada fraca", "üåßÔ∏è"],
      57:["Garoa gelada forte", "üåßÔ∏è"],
      61:["Chuva fraca", "üåßÔ∏è"],
      63:["Chuva moderada", "üåßÔ∏è"],
      65:["Chuva forte", "üåßÔ∏è"],
      66:["Chuva gelada fraca", "üåßÔ∏è"],
      67:["Chuva gelada forte", "üåßÔ∏è"],
      71:["Neve fraca", "üå®Ô∏è"],
      73:["Neve moderada", "üå®Ô∏è"],
      75:["Neve forte", "üå®Ô∏è"],
      77:["Gr√£os de neve", "üå®Ô∏è"],
      80:["Pancadas fracas", "üå¶Ô∏è"],
      81:["Pancadas moderadas", "üåßÔ∏è"],
      82:["Pancadas fortes", "‚õàÔ∏è"],
      85:["Pancadas de neve fracas", "üå®Ô∏è"],
      86:["Pancadas de neve fortes", "üå®Ô∏è"],
      95:["Trovoadas", "‚õàÔ∏è"],
      96:["Trovoadas com granizo", "‚õàÔ∏è"],
      99:["Trovoadas com granizo forte", "‚õàÔ∏è"],
    };
    return map[code] || ["Condi√ß√£o desconhecida", "üå°Ô∏è"];
  }

  function showHint(msg){
    out.innerHTML = `<div class="hint">${msg}</div>`;
  }

  async function fetchGeocodeCity(name){
    const url = new URL("https://geocoding-api.open-meteo.com/v1/search");
    url.searchParams.set("name", name);
    url.searchParams.set("count", "6");
    url.searchParams.set("language", "pt");
    url.searchParams.set("format", "json");
    const r = await fetch(url.toString());
    if(!r.ok) throw new Error("Falha no geocoding");
    const d = await r.json();
    return d.results || [];
  }

  function findClosestHourlyIndex(hourlyTimes, targetISO){
    if(!hourlyTimes || !hourlyTimes.length) return -1;
    const target = new Date(targetISO).getTime();
    let best = 0;
    let bestDiff = Infinity;
    for(let i=0;i<hourlyTimes.length;i++){
      const t = new Date(hourlyTimes[i]).getTime();
      const diff = Math.abs(t - target);
      if(diff < bestDiff){
        bestDiff = diff;
        best = i;
      }
    }
    return best;
  }

  function buildDaySlots(hourly){
    // Pega hoje (local) e monta 06h/12h/18h (mais pr√≥ximo) dentro do array hourly
    const now = new Date();
    const y = now.getFullYear(), m = now.getMonth(), d = now.getDate();

    const targets = [
      { key:"Manh√£", hour:6 },
      { key:"Tarde", hour:12 },
      { key:"Noite", hour:18 },
    ];

    const outSlots = [];

    for(const t of targets){
      const dt = new Date(y, m, d, t.hour, 0, 0);
      const idx = findClosestHourlyIndex(hourly.time, dt.toISOString());
      if(idx < 0) continue;

      const code = hourly.weather_code?.[idx];
      const [desc, icon] = wx(code, true);
      outSlots.push({
        name: t.key,
        time: hourly.time?.[idx],
        icon,
        desc,
        temp: hourly.temperature_2m?.[idx],
        pop: hourly.precipitation_probability?.[idx],
        wind: hourly.wind_speed_10m?.[idx],
        hum: hourly.relative_humidity_2m?.[idx]
      });
    }

    return outSlots;
  }

  function buildAlerts(hourly, startIdx){
    const alerts = [];
    if(!hourly?.time?.length) return alerts;

    const endIdx = Math.min(hourly.time.length, startIdx + ALERT_LOOKAHEAD_HOURS);

    // chuva
    let bestPop = -1, bestPopIdx = -1;
    for(let i=startIdx;i<endIdx;i++){
      const pop = hourly.precipitation_probability?.[i];
      if(pop != null && pop > bestPop){
        bestPop = pop;
        bestPopIdx = i;
      }
    }
    if(bestPop >= ALERT_POP_THRESHOLD && bestPopIdx >= 0){
      const when = toPtHour(hourly.time[bestPopIdx]);
      const pr = hourly.precipitation?.[bestPopIdx];
      alerts.push({
        icon:"üåßÔ∏è",
        title:`Alta chance de chuva nas pr√≥ximas ${ALERT_LOOKAHEAD_HOURS} horas`,
        text:`Pico previsto por volta de ${when} com ${fmt(bestPop,0)}% de chance${pr!=null ? ` ‚Ä¢ ~${fmt(pr,1)} mm` : ""}.`
      });
    }

    // vento/rajadas
    let bestGust = -1, bestGustIdx = -1;
    for(let i=startIdx;i<endIdx;i++){
      const gust = hourly.wind_gusts_10m?.[i];
      if(gust != null && gust > bestGust){
        bestGust = gust;
        bestGustIdx = i;
      }
    }
    if(bestGust >= ALERT_GUST_THRESHOLD && bestGustIdx >= 0){
      const when = toPtHour(hourly.time[bestGustIdx]);
      const wind = hourly.wind_speed_10m?.[bestGustIdx];
      alerts.push({
        icon:"üí®",
        title:`Vento forte nas pr√≥ximas ${ALERT_LOOKAHEAD_HOURS} horas`,
        text:`Rajadas podem chegar a ${fmt(bestGust,0)} km/h por volta de ${when}${wind!=null ? ` ‚Ä¢ vento ${fmt(wind,0)} km/h` : ""}.`
      });
    }

    return alerts;
  }

  async function fetchWeather(lat, lon, label=""){
    out.innerHTML = `<p class="muted"><strong>Consultando previs√£o...</strong></p>`;
    try{
      const url = new URL("https://api.open-meteo.com/v1/forecast");
      url.searchParams.set("latitude", String(lat));
      url.searchParams.set("longitude", String(lon));
      url.searchParams.set("timezone", "auto");

      // Agora (bem completo)
      url.searchParams.set("current",
        [
          "temperature_2m",
          "apparent_temperature",
          "relative_humidity_2m",
          "precipitation",
          "weather_code",
          "cloud_cover",
          "pressure_msl",
          "wind_speed_10m",
          "wind_direction_10m",
          "wind_gusts_10m",
          "is_day",
          "visibility"
        ].join(",")
      );

      // Pr√≥ximas horas
      url.searchParams.set("hourly",
        [
          "temperature_2m",
          "apparent_temperature",
          "precipitation_probability",
          "precipitation",
          "weather_code",
          "wind_speed_10m",
          "wind_gusts_10m",
          "relative_humidity_2m"
        ].join(",")
      );

      // 7 dias
      url.searchParams.set("daily",
        [
          "weather_code",
          "temperature_2m_max",
          "temperature_2m_min",
          "precipitation_probability_max",
          "precipitation_sum",
          "uv_index_max",
          "sunrise",
          "sunset",
          "wind_speed_10m_max"
        ].join(",")
      );

      const r = await fetch(url.toString());
      if(!r.ok) throw new Error("Falha na consulta");
      const d = await r.json();

      const cur = d.current || {};
      const daily = d.daily || {};
      const hourly = d.hourly || {};
      const tz = d.timezone || "auto";

      const isDay = cur.is_day === 1;
      const [desc, icon] = wx(cur.weather_code, isDay);

      // Constr√≥i 7 dias
      const days = (daily.time || []).map((t, i) => ({
        date: t,
        code: daily.weather_code?.[i],
        max: daily.temperature_2m_max?.[i],
        min: daily.temperature_2m_min?.[i],
        rainP: daily.precipitation_probability_max?.[i],
        rainSum: daily.precipitation_sum?.[i],
        uv: daily.uv_index_max?.[i],
        sunrise: daily.sunrise?.[i],
        sunset: daily.sunset?.[i],
        windMax: daily.wind_speed_10m_max?.[i],
      }));

      // Para barra min/max
      const mins = days.map(x => x.min).filter(x => x!=null);
      const maxs = days.map(x => x.max).filter(x => x!=null);
      const tMinAll = mins.length ? Math.min(...mins) : 0;
      const tMaxAll = maxs.length ? Math.max(...maxs) : 1;
      const span = Math.max(1, tMaxAll - tMinAll);

      // Pr√≥ximas 24 horas a partir do "current.time"
      const nowIso = cur.time || (hourly.time ? hourly.time[0] : null);
      let startIdx = 0;
      if(nowIso && hourly.time){
        startIdx = Math.max(0, hourly.time.findIndex(t => t >= nowIso));
        if(startIdx < 0) startIdx = 0;
      }
      const hours24 = (hourly.time || []).slice(startIdx, startIdx + 24).map((t, i) => {
        const idx = startIdx + i;
        const [hd, hi] = wx(hourly.weather_code?.[idx], true);
        return {
          time: t,
          icon: hi,
          temp: hourly.temperature_2m?.[idx],
          feels: hourly.apparent_temperature?.[idx],
          pop: hourly.precipitation_probability?.[idx],
          wind: hourly.wind_speed_10m?.[idx],
          gust: hourly.wind_gusts_10m?.[idx],
          hum: hourly.relative_humidity_2m?.[idx],
          pr: hourly.precipitation?.[idx]
        };
      });

      // Resumo manh√£/tarde/noite (hoje)
      const slots = buildDaySlots(hourly);

      // Alertas r√°pidos (pr√≥ximas X horas)
      const alerts = buildAlerts(hourly, startIdx);

      const placeLine = label
        ? `<span class="chip">üìç ${label}</span>`
        : `<span class="chip">üìç Coordenadas: ${lat}, ${lon}</span>`;

      const updatedLine = cur.time
        ? `<span class="chip">üïí Atualizado: ${new Date(cur.time).toLocaleString("pt-BR")}</span>`
        : `<span class="chip">üïí Atualizado: agora</span>`;

      out.innerHTML = `
        <div class="titlebar">
          <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
            ${placeLine}
            ${updatedLine}
            <span class="chip">‚è±Ô∏è Fuso: ${tz}</span>
          </div>
          <div class="small">Fonte: Open-Meteo</div>
        </div>

        ${alerts.length ? `
          <section class="card">
            <div class="titlebar">
              <h2 class="h2">Alertas r√°pidos</h2>
              <span class="small">baseado nas pr√≥ximas ${ALERT_LOOKAHEAD_HOURS}h</span>
            </div>
            <div class="divider"></div>
            <div class="stack" style="margin-top:0">
              ${alerts.map(a => `
                <div class="alert">
                  <div style="font-size:18px">${a.icon}</div>
                  <div>
                    <div class="aTitle">${a.title}</div>
                    <div class="aText">${a.text}</div>
                  </div>
                </div>
              `).join("")}
            </div>
          </section>
        ` : ``}

        ${slots.length ? `
          <section class="card">
            <div class="titlebar">
              <h2 class="h2">Resumo do dia</h2>
              <span class="small">Manh√£ ‚Ä¢ Tarde ‚Ä¢ Noite</span>
            </div>
            <div class="divider"></div>

            <div class="tri">
              ${slots.map(s => `
                <div class="slot">
                  <div class="slotTop">
                    <div>
                      <div class="slotName">${s.name}</div>
                      <div class="small">${s.time ? toPtHour(s.time) : ""} ‚Ä¢ ${s.desc}</div>
                    </div>
                    <div class="slotIcon">${s.icon}</div>
                  </div>

                  <div class="slotTemp">${fmt(s.temp,0)}¬∞</div>
                  <div class="slotMeta">
                    Chuva: ${fmt(s.pop,0)}% ‚Ä¢ Vento: ${fmt(s.wind,0)} km/h<br/>
                    Umidade: ${fmt(s.hum,0)}%
                  </div>
                </div>
              `).join("")}
            </div>
          </section>
        ` : ``}

        <div class="grid2">
          <!-- AGORA -->
          <section class="card" style="padding:16px">
            <div class="titlebar">
              <h2 class="h2">Agora</h2>
              <span class="pill">${icon} ${desc}</span>
            </div>

            <div class="divider"></div>

            <div class="kpi">
              <div>
                <div class="tempBig">${fmt(cur.temperature_2m,0)}¬∞</div>
                <div class="wxDesc">Sensa√ß√£o: ${fmt(cur.apparent_temperature,0)}¬∞ ‚Ä¢ Umidade: ${fmt(cur.relative_humidity_2m,0)}%</div>
              </div>
            </div>

            <div class="miniGrid">
              <div class="miniCard">
                <div class="label">Vento</div>
                <div class="val">${fmt(cur.wind_speed_10m,0)} km/h</div>
                <div class="small">Rajadas: ${fmt(cur.wind_gusts_10m,0)} km/h ‚Ä¢ Dire√ß√£o: ${fmt(cur.wind_direction_10m,0)}¬∞</div>
              </div>
              <div class="miniCard">
                <div class="label">Chuva agora</div>
                <div class="val">${fmt(cur.precipitation,1)} mm</div>
                <div class="small">Nebulosidade: ${fmt(cur.cloud_cover,0)}%</div>
              </div>
              <div class="miniCard">
                <div class="label">Press√£o</div>
                <div class="val">${fmt(cur.pressure_msl,0)} hPa</div>
                <div class="small">Conforto varia com umidade</div>
              </div>
              <div class="miniCard">
                <div class="label">Visibilidade</div>
                <div class="val">${cur.visibility != null ? fmt(cur.visibility/1000,1) + " km" : "‚Äî"}</div>
                <div class="small">${cur.is_day===1 ? "Dia" : "Noite"}</div>
              </div>
            </div>
          </section>

          <!-- DESTAQUES DO DIA -->
          <section class="card" style="padding:16px">
            <div class="titlebar">
              <h2 class="h2">Hoje</h2>
              <span class="small">${days[0] ? toPtDay(days[0].date) : ""}</span>
            </div>
            <div class="divider"></div>

            ${
              days[0] ? `
              <div class="miniGrid">
                <div class="miniCard">
                  <div class="label">M√°xima / M√≠nima</div>
                  <div class="val">${fmt(days[0].max,0)}¬∞ / ${fmt(days[0].min,0)}¬∞</div>
                  <div class="small">Vento m√°x: ${fmt(days[0].windMax,0)} km/h</div>
                </div>
                <div class="miniCard">
                  <div class="label">Chance de chuva</div>
                  <div class="val">${fmt(days[0].rainP,0)}%</div>
                  <div class="small">Acumulado: ${fmt(days[0].rainSum,1)} mm</div>
                </div>
                <div class="miniCard">
                  <div class="label">√çndice UV (m√°x)</div>
                  <div class="val">${fmt(days[0].uv,0)}</div>
                  <div class="small">Use prote√ß√£o se alto</div>
                </div>
                <div class="miniCard">
                  <div class="label">Sol</div>
                  <div class="val">üåÖ ${days[0].sunrise ? new Date(days[0].sunrise).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}) : "‚Äî"} ‚Ä¢ üåá ${days[0].sunset ? new Date(days[0].sunset).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}) : "‚Äî"}</div>
                  <div class="small">Nascer / P√¥r do sol</div>
                </div>
              </div>
              ` : `<p class="muted">Sem dados di√°rios dispon√≠veis.</p>`
            }
          </section>
        </div>

        <!-- PR√ìXIMAS HORAS -->
        <section class="card">
          <div class="titlebar">
            <h2 class="h2">Pr√≥ximas 24 horas</h2>
            <span class="small">Temperatura ‚Ä¢ chuva ‚Ä¢ vento</span>
          </div>
          <div class="divider"></div>

          ${hours24.length ? `
            <div class="hours">
              ${hours24.map(h => `
                <div class="hourCard">
                  <div class="hourTime">${toPtHour(h.time)}</div>
                  <div class="hourIcon">${h.icon}</div>
                  <div class="hourTemp">${fmt(h.temp,0)}¬∞</div>
                  <div class="hourMeta">
                    Sensa√ß√£o: ${fmt(h.feels,0)}¬∞<br/>
                    Chuva: ${fmt(h.pop,0)}% ‚Ä¢ ${fmt(h.pr,1)} mm<br/>
                    Vento: ${fmt(h.wind,0)} km/h ‚Ä¢ Raj: ${fmt(h.gust,0)}<br/>
                    Umidade: ${fmt(h.hum,0)}%
                  </div>
                </div>
              `).join("")}
            </div>
          ` : `<p class="muted">Sem dados hor√°rios dispon√≠veis.</p>`}
        </section>

        <!-- 7 DIAS -->
        <section class="card">
          <div class="titlebar">
            <h2 class="h2">Previs√£o para 7 dias</h2>
            <span class="small">M√°x/M√≠n ‚Ä¢ chuva ‚Ä¢ UV ‚Ä¢ sol</span>
          </div>
          <div class="divider"></div>

          ${days.length ? `
            <div class="days">
              ${days.slice(0,7).map(x => {
                const [dsc, ico] = wx(x.code, true);
                const left = ((x.min - tMinAll) / span) * 100;
                const right = ((x.max - tMinAll) / span) * 100;
                const w = Math.max(6, right - left);
                return `
                  <div class="dayRow">
                    <div class="dayLeft">
                      <div class="dayTop">
                        <span class="dayName">${toPtDay(x.date)}</span>
                        <span class="dayIcon">${ico}</span>
                        <span class="small">${dsc}</span>
                      </div>

                      <div class="dayBarWrap">
                        <span class="tMin">${fmt(x.min,0)}¬∞</span>
                        <div class="bar"><span style="left:${clamp(left,0,100)}%;width:${clamp(w,0,100)}%"></span></div>
                        <span class="tMax">${fmt(x.max,0)}¬∞</span>
                      </div>

                      <div class="small">
                        üåÖ ${x.sunrise ? new Date(x.sunrise).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}) : "‚Äî"}
                        ‚Ä¢ üåá ${x.sunset ? new Date(x.sunset).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}) : "‚Äî"}
                        ‚Ä¢ üí® ${fmt(x.windMax,0)} km/h
                      </div>
                    </div>

                    <div class="dayRight">
                      <span class="tag">Chuva: ${fmt(x.rainP,0)}%</span>
                      <span class="tag">Acum.: ${fmt(x.rainSum,1)} mm</span>
                      <span class="tag">UV: ${fmt(x.uv,0)}</span>
                    </div>
                  </div>
                `;
              }).join("")}
            </div>
          ` : `<p class="muted">Sem dados di√°rios dispon√≠veis.</p>`}
        </section>

        <p class="muted">
          Observa√ß√£o: probabilidades e acumulados s√£o estimativas. Para decis√µes cr√≠ticas, confirme com fontes oficiais.
        </p>
      `;

      // Salva √∫ltima consulta
      localStorage.setItem(LS_KEY, JSON.stringify({ lat, lon, label, at: Date.now() }));

    }catch(e){
      out.innerHTML = `<p style="color:#b42318"><strong>Erro:</strong> n√£o foi poss√≠vel consultar agora. Tente novamente.</p>`;
    }
  }

  // Sugest√µes de cidade
  let ddTimer = null;
  cityEl.addEventListener("input", () => {
    const q = cityEl.value.trim();
    clearTimeout(ddTimer);
    if(q.length < 3){
      cityList.style.display = "none";
      cityList.innerHTML = "";
      return;
    }
    ddTimer = setTimeout(async () => {
      try{
        const results = await fetchGeocodeCity(q);
        if(!results.length){
          cityList.style.display = "none";
          cityList.innerHTML = "";
          return;
        }
        cityList.innerHTML = results.map((r) => {
          const name = [r.name, r.admin1, r.country].filter(Boolean).join(" ‚Ä¢ ");
          const sub = `Lat ${fmt(r.latitude,2)} ‚Ä¢ Lon ${fmt(r.longitude,2)}`;
          return `<button type="button" data-lat="${r.latitude}" data-lon="${r.longitude}" data-label="${name.replaceAll('"','&quot;')}">
                    ${r.name} <span class="sub">${name} ‚Äî ${sub}</span>
                  </button>`;
        }).join("");
        cityList.style.display = "block";
      }catch(err){
        cityList.style.display = "none";
        cityList.innerHTML = "";
      }
    }, 300);
  });

  document.addEventListener("click", (e) => {
    if(!cityList.contains(e.target) && e.target !== cityEl){
      cityList.style.display = "none";
    }
  });

  cityList.addEventListener("click", (e) => {
    const btn = e.target.closest("button[data-lat]");
    if(!btn) return;
    const lat = Number(btn.dataset.lat);
    const lon = Number(btn.dataset.lon);
    const label = btn.dataset.label || "";
    cityEl.value = label || cityEl.value;
    cityList.style.display = "none";
    fetchWeather(lat.toFixed(4), lon.toFixed(4), label);
  });

  document.getElementById("cityBtn").addEventListener("click", async () => {
    const q = cityEl.value.trim();
    if(q.length < 3){
      showHint("Digite pelo menos 3 letras no campo de cidade (ex: <strong>Paulino Neves</strong>).");
      return;
    }
    try{
      const results = await fetchGeocodeCity(q);
      if(!results.length){
        showHint("N√£o encontrei essa cidade. Tente escrever de outro jeito (ex: <strong>Paulino Neves</strong> ou <strong>S√£o Lu√≠s</strong>).");
        return;
      }
      const r = results[0];
      const label = [r.name, r.admin1, r.country].filter(Boolean).join(" ‚Ä¢ ");
      fetchWeather(Number(r.latitude).toFixed(4), Number(r.longitude).toFixed(4), label);
    }catch(err){
      out.innerHTML = `<p style="color:#b42318"><strong>Erro:</strong> n√£o foi poss√≠vel buscar a cidade agora.</p>`;
    }
  });

  document.getElementById("geoBtn").addEventListener("click", () => {
    if(!navigator.geolocation){
      out.innerHTML = `<p style="color:#b42318"><strong>Seu navegador n√£o suporta geolocaliza√ß√£o.</strong></p>`;
      return;
    }
    out.textContent = "Obtendo localiza√ß√£o...";
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude.toFixed(4);
        const lon = pos.coords.longitude.toFixed(4);
        fetchWeather(lat, lon, "Minha localiza√ß√£o");
      },
      () => out.innerHTML = `<p style="color:#b42318"><strong>Permiss√£o negada</strong> ou localiza√ß√£o indispon√≠vel.</p>`,
      { enableHighAccuracy: true, timeout: 12000 }
    );
  });

  document.getElementById("coordBtn").addEventListener("click", () => {
    const lat = Number(String(latEl.value).replace(",", "."));
    const lon = Number(String(lonEl.value).replace(",", "."));
    if(!Number.isFinite(lat) || !Number.isFinite(lon)){
      out.innerHTML = `<p style="color:#b42318"><strong>Coordenadas inv√°lidas.</strong> Informe latitude e longitude.</p>`;
      return;
    }
    fetchWeather(lat.toFixed(4), lon.toFixed(4), `Coords: ${lat.toFixed(4)}, ${lon.toFixed(4)}`);
  });

  function tryAutoGeo(){
    if(!navigator.geolocation) return false;

    out.innerHTML = `<p class="muted"><strong>Obtendo sua localiza√ß√£o automaticamente...</strong></p>`;

    navigator.geolocation.getCurrentPosition(
      (pos) => {
        const lat = pos.coords.latitude.toFixed(4);
        const lon = pos.coords.longitude.toFixed(4);
        fetchWeather(lat, lon, "Minha localiza√ß√£o");
      },
      () => {
        // fallback: √∫ltima consulta salva
        try{
          const raw = localStorage.getItem(LS_KEY);
          if(raw){
            const last = JSON.parse(raw);
            if(last && last.lat != null && last.lon != null){
              fetchWeather(String(last.lat), String(last.lon), last.label || "");
              return;
            }
          }
        }catch(e){}
        showHint("N√£o consegui pegar sua localiza√ß√£o automaticamente. Clique em <strong>Usar minha localiza√ß√£o</strong> ou pesquise pela <strong>cidade</strong>.");
      },
      { enableHighAccuracy: true, timeout: 12000, maximumAge: 600000 }
    );

    return true;
  }

  // Auto: tenta geolocalizar ao abrir, sen√£o usa √∫ltima consulta
  (function boot(){
    const started = tryAutoGeo();
    if(started) return;

    try{
      const raw = localStorage.getItem(LS_KEY);
      if(!raw) return;
      const last = JSON.parse(raw);
      if(!last || last.lat==null || last.lon==null) return;
      fetchWeather(String(last.lat), String(last.lon), last.label || "");
    }catch(e){}
  })();
</script>

<footer class="st-footer">
  <div class="st-footer__wrap">
    <div class="st-footer__grid">
      <!-- Coluna esquerda -->
      <section class="st-footer__card">
        <h3 class="st-footer__title">Seguran√ßa Tech</h3>
        <p class="st-footer__text">
          Educa√ß√£o e ferramentas gratuitas para ajudar voc√™ a evitar golpes, phishing e riscos comuns na internet.
          Use com responsabilidade e sempre valide informa√ß√µes importantes por fontes oficiais.
        </p>
      </section>

      <!-- Coluna direita -->
      <section class="st-footer__card">
        <h3 class="st-footer__title">LINKS IMPORTANTES</h3>

        <div class="st-footer__links">
          <a class="st-footer__link" href="../sobre.html">Sobre</a>
          <a class="st-footer__link" href="../politica-de-privacidade.html">Pol√≠tica de Privacidade</a>
          <a class="st-footer__link" href="../termos-de-uso.html">Termos de Uso</a>
        </div>
      </section>
    </div>

    <div class="st-footer__hr"></div>

    <div class="st-footer__bottom">
      <span>¬© 2026 Seguran√ßa Tech</span>
      <span class="st-footer__dot">‚Ä¢</span>
      <a href="../ferramentas.html">Ferramentas</a>
      <span class="st-footer__dot">‚Ä¢</span>
      <a href="../blog.html">Artigos</a>
    </div>
  </div>
</footer>

</body>
</html>
